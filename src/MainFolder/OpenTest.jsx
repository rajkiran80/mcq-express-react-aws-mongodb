import style from "./OpenTest.css";
import React,{useEffect, useState} from "react";
import QuestionNumber from "./QuestionNumber";
import QuestionsAndAnswers from "./QuestionsAndAnswers";
import Questions from "../jsonData/question";
import store from "../redux/CenterState";
import { useParams } from "react-router-dom";
import axios from "axios";

const OpenTest=()=>{
    const [updateUi,setUpdateUi]=useState(true);
    const {examName,examSubject,id}=useParams();
    const [questionsAndAnswers,setQuestionsAndAnswers]=useState(null);
    
    store.subscribe(()=>{
        setUpdateUi(!updateUi)
    })
    
    useEffect(()=>{
        axios.get(`https://mcq-api-react-express.herokuapp.com/fetch-mcq/${examName}/${examSubject}`)
        .then((result)=>{
             const data=result.data.filter((question)=>{
                  if(question._id == id){
                      return question;
                  }
             })
             store.dispatch({
                 type:"SHOW_CURRENT_QUESTION",
                 currentOption:1
             })
             setQuestionsAndAnswers(data[0]);
        })
        .catch((err)=>{
             console.log(err);
        })
    },[])
    return(
        <div className="openTestContainer">
            {
              questionsAndAnswers === null ? <h2 style={{textAlign:"center",color:"white"}}>DATA IS LAODING.....</h2> :
              <>  
                <div className="mcqQuestionsNumber">
                    <ul>
                        <QuestionNumber numberOfQuestions={questionsAndAnswers.questionsAndAnswers.length} questionsAndAnswers={questionsAndAnswers.questionsAndAnswers}/>
                    </ul>
                </div>
                <QuestionsAndAnswers questionAndAnsersOptions={questionsAndAnswers.questionsAndAnswers}/>
             </> 
           }
        </div>
    )
}
export default OpenTest;